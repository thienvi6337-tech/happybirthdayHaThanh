<!doctype html>
<html lang="vi" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Home Sweet Home</title>

  <!-- Font title -->
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f6f0e5; --paper:#efe6d2; --text:#3b2f2f; --accent:#b2552a; --muted:#806b5f;
      --surface:#f4efe6; --shadow:0 3px 0 rgba(0,0,0,.2);
    }
    [data-theme="dark"]{
      --bg:#1f1b16; --paper:#2a241d; --text:#f5eddc; --accent:#ffb07a; --muted:#cbbaa5;
      --surface:#221d17; --shadow:0 3px 0 rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.6 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto}
    a{color:inherit}
    .container{max-width:1100px;margin:0 auto;padding:18px}

    /* ===== NAV with 4 buttons + centered title ===== */
    .topbar{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:.75rem;margin:10px 0 16px}
    .btn-row{display:flex;gap:.5rem;flex-wrap:wrap;justify-content:flex-start}
    .btn-row.right{justify-content:flex-end}
    .btn-paper{
      background:var(--paper); border:0; padding:.6rem .9rem; border-radius:10px; box-shadow:var(--shadow);
      font-weight:700; cursor:pointer; transition:.15s; white-space:nowrap
    }
    .btn-paper:hover{transform:translateY(-2px)}
    .site-title{
      font-family:'Pacifico',cursive; font-size:34px; letter-spacing:.5px; user-select:none; cursor:pointer;
      text-align:center; text-shadow:0 2px 0 rgba(0,0,0,.18)
    }

    /* Theme toggle */
    .theme-toggle{position:fixed; top:14px; right:14px; background:var(--paper); padding:.5rem .7rem; border-radius:10px; cursor:pointer; box-shadow:var(--shadow); z-index:50}

    /* ===== Carousel ===== */
    .carousel{position:relative; overflow:hidden; border-radius:14px; background:var(--surface); box-shadow:var(--shadow)}
    .track{display:flex; transition:transform .45s ease-in-out; touch-action:pan-y}
    .slide{min-width:100%; height:420px; display:grid; place-items:center; background:#000}
    .slide img{max-width:100%; max-height:100%; object-fit:contain}
    .car-nav{position:absolute; top:50%; transform:translateY(-50%); background:var(--paper); border:0; padding:.5rem .7rem; border-radius:50%; cursor:pointer; box-shadow:var(--shadow)}
    .car-prev{left:10px} .car-next{right:10px}
    .car-dots{position:absolute; bottom:8px; left:0; right:0; display:flex; justify-content:center; gap:.4rem}
    .car-dots button{width:8px;height:8px;border-radius:50%;border:0;background:#aaa;opacity:.6}
    .car-dots button.active{opacity:1;background:var(--accent)}

    .caption{font-size:.95rem; margin-top:10px; background:var(--surface); padding:10px 12px; border-radius:10px; box-shadow:var(--shadow)}

    /* ===== Calendar (from earlier plan) ===== */
    .calendar-section{margin:2rem 0}
    .cal-wrap{background:var(--surface); border:1px solid rgba(0,0,0,.08); box-shadow:var(--shadow); padding:1rem; border-radius:10px}
    .cal-header{display:flex;align-items:center;justify-content:center;gap:.5rem;margin-bottom:.5rem}
    .cal-title{font-weight:700;letter-spacing:.5px}
    .cal-nav{background:var(--paper);border:0;padding:.4rem .6rem;border-radius:8px;cursor:pointer;box-shadow:var(--shadow)}
    .cal-week{display:grid;grid-template-columns:repeat(7,1fr);gap:.25rem;margin:.5rem 0;color:var(--accent);font-weight:600}
    .cal-week span{text-align:center}
    .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:.25rem}
    .cal-cell{background:var(--paper);min-height:64px;border-radius:8px;position:relative;padding:.45rem;display:flex;align-items:flex-start;justify-content:flex-start;cursor:default}
    .cal-cell .d{font-weight:700}
    .cal-cell .emoji{position:absolute;right:.35rem;bottom:.2rem;font-size:18px}
    .cal-cell.today{outline:2px dashed var(--accent);background:rgba(255,210,127,.5)}
    .cal-cell.muted{opacity:.45}
    .cal-cell:hover{transform:translateY(-2px);box-shadow:0 4px 0 rgba(0,0,0,.2);transition:.15s}
    .cal-tooltip{position:fixed;pointer-events:none;background:#000;color:#fff;padding:.35rem .5rem;border-radius:6px;font-size:.85rem;z-index:60;transform:translate(-50%,-120%);white-space:nowrap}
    .btn-mini{background:var(--accent);color:#fff;border:0;border-radius:8px;padding:.4rem .6rem;cursor:pointer}

    /* ===== Letter section & paw effect ===== */
    .letter{position:relative; background:var(--surface); border-radius:12px; padding:16px; box-shadow:var(--shadow)}
    .envelope{display:flex; align-items:center; gap:10px; background:var(--paper); padding:10px 12px; border-radius:10px; cursor:pointer; box-shadow:var(--shadow)}
    .letter-content{display:none; margin-top:12px}
    .letter.open .letter-content{display:block}
    #paw-layer{position:absolute; inset:0; pointer-events:none; overflow:visible}
    .paw-pop{position:absolute; font-size:18px; line-height:1; opacity:0; transform:translate(-50%, -10px) scale(.92) rotate(var(--rot,0deg)); filter:drop-shadow(0 2px 0 rgba(0,0,0,.18)); animation:paw-pop .95s cubic-bezier(.22,.61,.36,1) forwards}
    @keyframes paw-pop{
      0%{opacity:0; transform:translate(-50%,6px) scale(.9) rotate(var(--rot))}
      20%{opacity:.95; transform:translate(-50%,-6px) scale(1.06) rotate(var(--rot))}
      100%{opacity:0; transform:translate(calc(-50% + var(--dx,0px)),-48px) scale(1) rotate(var(--rot))}
    }

    /* ===== Scroll reveal ===== */
    .reveal{opacity:0; transform:translateY(14px); transition:opacity .35s ease, transform .35s ease}
    .reveal.in{opacity:1; transform:none}

    /* ===== Music + GIFs ===== */
    .music-block{background:var(--surface); padding:12px; border-radius:12px; box-shadow:var(--shadow)}
    .gif-row{display:flex; gap:.75rem; flex-wrap:wrap}
    .gif-row img{height:120px; border-radius:10px; box-shadow:var(--shadow); animation:float 3.8s ease-in-out infinite}
    @keyframes float{
      0%,100%{transform:translateY(0) rotate(0deg)}
      50%{transform:translateY(-4px) rotate(.8deg)}
    }

    /* ===== Horizontal quote slider ===== */
    .marquee{overflow:hidden; background:var(--surface); border-radius:12px; padding:10px; box-shadow:var(--shadow)}
    .marquee-track{display:flex; gap:12px; animation:scrollX 22s linear infinite}
    .marquee img{height:90px; border-radius:10px; display:block}
    @keyframes scrollX{from{transform:translateX(0)} to{transform:translateX(-50%)}}

    /* ===== Modal ===== */
    .modal{position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.4); z-index:70}
    .modal.open{display:grid}
    .modal-card{max-width:720px; background:var(--surface); color:var(--text); border-radius:14px; padding:16px; box-shadow:var(--shadow)}
    .modal-card img{max-width:100%; border-radius:10px}

    /* helpers */
    h2{margin:18px 0 10px}
    .muted{color:var(--muted)}
    .space{height:16px}
  </style>
</head>
<body>
<div class="theme-toggle" id="themeToggle" title="ƒê·ªïi giao di·ªán s√°ng/t·ªëi">üåû/üåô</div>

<div class="container">

  <!-- ===== NAV ===== -->
  <nav class="topbar reveal">
    <div class="btn-row">
      <button class="btn-paper" data-scroll="#sweet-letter">Sweet Letter</button>
      <button class="btn-paper" data-scroll="#birthday-letter">Birthday Letter</button>
    </div>

    <div class="site-title" id="homeTitle">Home Sweet Home</div>

    <div class="btn-row right">
      <button class="btn-paper" id="btnSadDay">N·∫øu nh∆∞ b·∫°n ƒëang c√≥ m·ªôt ng√†y bu·ªìn ch√°n</button>
      <button class="btn-paper" id="btnTiredWork">N·∫øu nh∆∞ b·∫°n ƒëang ngao ng√°n c√¥ng vi·ªác ·ªü c√¥ng ty</button>
    </div>
  </nav>

  <!-- ===== CAROUSEL ===== -->
  <section class="reveal">
    <div class="carousel" id="carousel">
      <div class="track">
        <div class="slide"><img src="assets/gallery/HT1.jpg" alt="HT1"></div>
        <div class="slide"><img src="assets/gallery/HT2.jpg" alt="HT2"></div>
        <div class="slide"><img src="assets/gallery/HT3.jpg" alt="HT3"></div>
        <div class="slide"><img src="assets/gallery/HT4.jpg" alt="HT4"></div>
        <div class="slide"><img src="assets/gallery/Tinkerbell.jpg" alt="Tinkerbell"></div>
        <div class="slide"><img src="assets/gallery/Tinkerbell1.jpg" alt="Tinkerbell1"></div>
      </div>
      <button class="car-nav car-prev" aria-label="Prev">‚Äπ</button>
      <button class="car-nav car-next" aria-label="Next">‚Ä∫</button>
      <div class="car-dots" aria-hidden="true"></div>
    </div>
    <div class="caption">
      Em ƒë·∫∑t ·∫£nh c·ªßa c·∫£ hai em b√© ·ªü ƒë√¢y b·ªüi v√¨ c√≥ l·∫Ω n√≥ l√† kho·∫£ng th·ªùi gian h·ªìn nhi√™n nh·∫•t trong c·∫£ cu·ªôc ƒë·ªùi n√†y - m√† b·∫•t k·ª≥ l√∫c n√†o nh√¨n l·∫°i, ch√∫ng ta c≈©ng s·∫Ω m·ªâm c∆∞·ªùi (nh·ªâ)? Gi·ªØ ƒë∆∞·ª£c s·ª± h·ªìn nhi√™n trong t·∫•t c·∫£ m·ªçi ƒëi·ªÅu th·∫≠t kh√≥ - nh∆∞ng c≈©ng s·∫Ω th·∫≠t tuy·ªát, n√™n hi v·ªçng l√† t·ª•i m√¨nh c√≥ th·ªÉ vui v·∫ª v·ªõi nhau nh∆∞ tr·∫ª em v√† n√¢ng niu nhau nh∆∞ nh·ªØng em b√©, nho√© ·∫° (<a href="https://youtu.be/OUZA0RAv85U?si=pDRpDc3j2zMajV19" target="_blank" rel="noopener">link</a>). Th·ªùi gian s·∫Ω l·∫•y ƒëi c·ªßa m·ªói ng∆∞·ªùi nhi·ªÅu th·ª©, nh∆∞ng, n·∫øu m·ªát qu√° th√¨ em hi v·ªçng ng∆∞·ªùi c√≥ th·ªÉ quay v·ªÅ nh√† nh√° - nh√† th·∫≠t th√¨ c√≥ gia ƒë√¨nh c·ªßa H√† Thanh ƒë·∫•y, c√≤n ch·ªó n√†y th√¨ (ch·∫Øc l√†) s·∫Ω c√≥ v√†i sweet moments ƒë·ªÉ ng∆∞·ªùi xem l·∫°i (...). Tinkerbell n√≥i l√† bi·∫øt ƒë√¢u sinh nh·∫≠t nƒÉm sau - khi ng∆∞·ªùi quay l·∫°i ƒë√¢y th√¨ nh·∫°c n·ªÅn c·ªßa chi·∫øc web n√†y khom ph·∫£i l√† Happy Birthday m√† l√† chi·∫øc b√†i Thi√™n Vi vi·∫øt ri√™ng cho ng∆∞·ªùi - hope so ^.^
    </div>
  </section>

  <div class="space"></div>

  <!-- ===== SWEET LETTER ===== -->
  <section id="sweet-letter" class="letter reveal">
    <div class="envelope" id="sweetOpen">
      ‚úâÔ∏è <b>Sweet Letter</b> ‚Äî B·∫•m ƒë·ªÉ m·ªü
    </div>
    <div class="letter-content">
      <!-- (Gi·ªØ nguy√™n n·ªôi dung Sweet Letter hi·ªán c√≥ c·ªßa b·∫°n ·ªü ƒë√¢y) -->
      <p>Ch√∫ng ta ƒë√£ c√πng tr·∫£i qua m·ªôt h√†nh tr√¨nh (kh√¥ng d√†i l·∫Øm m√† c≈©ng kh√¥ng ng·∫Øn l·∫Øm) v√† ·ªç o·∫π nhau h∆°i nhi·ªÅu, nh·ªâ?
      C√πng ƒë·∫øm ng∆∞·ª£c ƒë·∫øn ng√†y sinh nh·∫≠t H√† Thanh nho√© ‡¥¶‡µç‡¥¶‡¥ø(Àµ ‚Ä¢ÃÄ ·¥ó - Àµ ) ‚úß ‚Äî 09.11.2025 is comingggg ìáº ‚ãÜ.Àö ìÜâ ìÜù</p>
    </div>
  </section>

  <div class="space"></div>

  <!-- ===== BIRTHDAY LETTER (phong th∆∞) ===== -->
  <section id="birthday-letter" class="letter reveal">
    <div class="envelope" id="birthdayOpen">
      üíå <b>Birthday Letter</b> ‚Äî B·∫•m ƒë·ªÉ m·ªü phong th∆∞
    </div>
    <div class="letter-content">
      <!-- (GI·ªÆ NGUY√äN NGUY√äN VƒÇN b·∫°n ƒë√£ cung c·∫•p, kh√¥ng s·ª≠a) -->
      <p><i>C√≤n ƒë√¢y l√† nh·ªØng ƒëi·ªÅu ƒë∆°n gi·∫£n, kh√¥ng c·∫ßu k·ª≥ m√† Thi√™n Vi mu·ªën nh·∫Øn nh·ªß:</i></p>
      <p>‚Ä¶ (to√†n b·ªô ƒëo·∫°n d√†i b·∫°n ƒë√£ ƒë∆∞a ‚Äî gi·ªØ nguy√™n)...</p>
    </div>
  </section>

  <div class="space"></div>

  <!-- ===== MARQUEE QUOTES (th√™m ·∫£nh toion, benh, an, miss) ===== -->
  <section class="marquee reveal" aria-label="Quotes slider">
    <div class="marquee-track">
      <img src="assets/img/toion.png" alt="toion">
      <img src="assets/img/benh.png" alt="benh">
      <img src="assets/img/an.png" alt="an">
      <img src="assets/img/miss.png" alt="miss">
      <img src="assets/img/toion.png" alt="" aria-hidden="true">
      <img src="assets/img/benh.png" alt="" aria-hidden="true">
      <img src="assets/img/an.png" alt="" aria-hidden="true">
      <img src="assets/img/miss.png" alt="" aria-hidden="true">
    </div>
  </section>

  <div class="space"></div>

  <!-- ===== L·ªäCH V·∫†N NI√äN ===== -->
  <section id="lich-van-nien" class="calendar-section reveal">
    <h2>H√î BI·∫æN RA QU·∫¢ L·ªäCH V·∫†N NI√äN</h2>
    <div class="cal-wrap">
      <div class="cal-header">
        <button class="cal-nav" id="cal-prev" aria-label="Th√°ng tr∆∞·ªõc">‚Äπ</button>
        <div class="cal-title"><span id="cal-month"></span> <span id="cal-year"></span></div>
        <button class="cal-nav" id="cal-next" aria-label="Th√°ng sau">‚Ä∫</button>
      </div>
      <div class="cal-week">
        <span>T2</span><span>T3</span><span>T4</span><span>T5</span><span>T6</span><span>T7</span><span>CN</span>
      </div>
      <div class="cal-grid" id="cal-grid" aria-live="polite"></div>
      <div class="cal-legend">
        <button id="add-marker" class="btn-mini">+ Th·∫£ emoji m·ªëc (vd: üéÇ)</button>
        <small class="muted">Hover ƒë·ªÉ xem ghi ch√∫. Emoji l∆∞u c·ª•c b·ªô (localStorage).</small>
      </div>
    </div>
    <div id="cal-tooltip" class="cal-tooltip" role="tooltip" hidden></div>
  </section>

  <div class="space"></div>

  <!-- ===== MUSIC + GIFS ===== -->
  <section class="music-block reveal">
    <p><b>Test mic, test mic, chu·∫©n b·ªã l√™n nh·∫°c ch∆∞a ·∫°?</b> G√≤i, H√† Thanh b·∫•m dzo nh·∫°c i ·∫° =))</p>
    <audio id="bgm" src="assets/audio/happy-birthday.mp3" preload="none"></audio>
    <button class="btn-paper" id="musicToggle">‚ñ∂Ô∏è Play / ‚è∏Ô∏è Pause</button>

    <div class="gif-row" style="margin-top:10px">
      <!-- GIF m·ªõi ngay d∆∞·ªõi n√∫t nh·∫°c -->
      <img src="assets/gif/meo1.gif" alt="meo1">
      <img src="assets/gif/meo2.gif" alt="meo2">
      <img src="assets/gif/meo3.gif" alt="meo3">
    </div>

    <div class="gif-row" style="margin-top:10px">
      <!-- GIF hi·ªán t·∫°i, th√™m bobbing nh·∫π -->
      <img src="assets/gif/meocon.gif" alt="meocon">
      <img src="assets/gif/conmeo.gif" alt="conmeo">
      <img src="assets/gif/dancing-cat-dance.gif" alt="dancing cat">
    </div>
  </section>

  <div class="space"></div>

</div><!-- /container -->

<!-- ===== MODALS ===== -->
<div class="modal" id="modalSad">
  <div class="modal-card">
    <h3>N·∫øu nh∆∞ b·∫°n ƒëang c√≥ m·ªôt ng√†y bu·ªìn ch√°n</h3>
    <p>Th√¨ h√£y nh·ªõ l√† üëá</p>
    <img src="assets/img/cty.png" alt="cty" />
    <div style="margin-top:10px; text-align:right">
      <button class="btn-paper" data-close="#modalSad">ƒê√≥ng</button>
    </div>
  </div>
</div>

<div class="modal" id="modalTired">
  <div class="modal-card">
    <h3>N·∫øu nh∆∞ b·∫°n ƒëang ngao ng√°n c√¥ng vi·ªác ·ªü c√¥ng ty</h3>
    <p>Th√¨ h√£y nh·ªõ ƒë·∫øn t√¥i, t·∫°i v√¨ t√¥i c≈©ng v·∫≠y, nh∆∞ng m√†, t√¥i l√† m·ªôt b√© b√≤ ki·ªÉu üëá</p>
    <img src="assets/img/bo.png" alt="bo" />
    <div style="margin-top:10px; text-align:right">
      <button class="btn-paper" data-close="#modalTired">ƒê√≥ng</button>
    </div>
  </div>
</div>

<script>
/* ========= Theme ========= */
(function(){
  const root=document.documentElement, tgl=document.getElementById('themeToggle');
  const saved=localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme:dark)').matches?'dark':'light');
  root.setAttribute('data-theme', saved);
  tgl.textContent = saved==='dark'?'üåô':'üåû';
  tgl.onclick=()=>{const cur=root.getAttribute('data-theme'); const next=cur==='dark'?'light':'dark'; root.setAttribute('data-theme',next); localStorage.setItem('theme',next); tgl.textContent = next==='dark'?'üåô':'üåû';};
})();

/* ========= Smooth scroll ========= */
document.querySelectorAll('[data-scroll]').forEach(b=>b.addEventListener('click',e=>{
  const to=b.getAttribute('data-scroll'); const el=document.querySelector(to); if(el) el.scrollIntoView({behavior:'smooth'});
}));
document.getElementById('homeTitle').onclick=()=>window.scrollTo({top:0,behavior:'smooth'});

/* ========= Scroll reveal ========= */
(function(){
  const io=new IntersectionObserver((ents)=>{
    ents.forEach(en=>{ if(en.isIntersecting){ en.target.classList.add('in'); io.unobserve(en.target);} });
  },{threshold:.12});
  document.querySelectorAll('.reveal').forEach(el=>io.observe(el));
})();

/* ========= Carousel (swipe-able) ========= */
(function(){
  const root=document.getElementById('carousel');
  const track=root.querySelector('.track');
  const slides=[...root.querySelectorAll('.slide')];
  const prev=root.querySelector('.car-prev'), next=root.querySelector('.car-next');
  const dots=root.querySelector('.car-dots');
  let idx=0, startX=null, curX=0;

  slides.forEach((_,i)=>{const d=document.createElement('button'); d.addEventListener('click',()=>go(i)); dots.appendChild(d)});
  function updateDots(){ [...dots.children].forEach((d,i)=>d.classList.toggle('active', i===idx)); }
  function go(i){ idx=Math.max(0,Math.min(i,slides.length-1)); track.style.transform=`translateX(${-idx*100}%)`; updateDots(); }
  prev.onclick=()=>go(idx-1); next.onclick=()=>go(idx+1);
  updateDots(); go(0);

  track.addEventListener('pointerdown',e=>{startX=e.clientX; track.setPointerCapture(e.pointerId);});
  track.addEventListener('pointermove',e=>{ if(startX==null) return; curX=e.clientX; const dx=curX-startX; track.style.transform=`translateX(calc(${-idx*100}% + ${dx}px))`;});
  track.addEventListener('pointerup',e=>{ if(startX==null) return; const dx=curX-startX; if(Math.abs(dx)>60) go(idx+(dx<0?1:-1)); else go(idx); startX=null;});
})();

/* ========= Calendar (client-side) ========= */
(function(){
  const grid = document.getElementById('cal-grid');
  const mEl = document.getElementById('cal-month');
  const yEl = document.getElementById('cal-year');
  const tip = document.getElementById('cal-tooltip');
  const btnPrev = document.getElementById('cal-prev');
  const btnNext = document.getElementById('cal-next');
  const btnAdd = document.getElementById('add-marker');

  const MONTHS = ['Th√°ng 1','Th√°ng 2','Th√°ng 3','Th√°ng 4','Th√°ng 5','Th√°ng 6','Th√°ng 7','Th√°ng 8','Th√°ng 9','Th√°ng 10','Th√°ng 11','Th√°ng 12'];
  let view = new Date(); view.setDate(1);

  const key = 'van-nien-markers';
  const markers = JSON.parse(localStorage.getItem(key) || '{}');

  const fmt = (d)=> d.toISOString().slice(0,10);
  const sameDay=(a,b)=> a.getFullYear()==b.getFullYear() && a.getMonth()==b.getMonth() && a.getDate()==b.getDate();

  function render(){
    grid.innerHTML='';
    mEl.textContent=MONTHS[view.getMonth()];
    yEl.textContent=view.getFullYear();

    const firstDow=(view.getDay()+6)%7;
    const daysInMonth=new Date(view.getFullYear(),view.getMonth()+1,0).getDate();
    const prevDays=new Date(view.getFullYear(),view.getMonth(),0).getDate();
    const today=new Date(); const cells=[];

    for(let i=firstDow-1;i>=0;i--){
      const d=new Date(view.getFullYear(),view.getMonth()-1,prevDays-i);
      cells.push({d,muted:true});
    }
    for(let i=1;i<=daysInMonth;i++){
      const d=new Date(view.getFullYear(),view.getMonth(),i);
      cells.push({d});
    }
    while(cells.length%7!==0){
      const d=new Date(view.getFullYear(),view.getMonth()+1,(cells.length%7)+1);
      cells.push({d,muted:true});
    }

    cells.forEach(({d,muted})=>{
      const cell=document.createElement('div'); cell.className='cal-cell'+(muted?' muted':'')+(sameDay(d,today)?' today':''); cell.tabIndex=0; cell.dataset.date=fmt(d);
      const day=document.createElement('div'); day.className='d'; day.textContent=d.getDate(); cell.appendChild(day);

      const mark=markers[fmt(d)];
      if(mark){ const em=document.createElement('div'); em.className='emoji'; em.textContent=mark.emoji || 'üìå'; cell.appendChild(em); cell.dataset.note=mark.note || ''; }

      cell.addEventListener('mousemove', (e)=>{
        if(!cell.dataset.note && !markers[fmt(d)]) { tip.hidden=true; return; }
        tip.hidden=false; tip.textContent=(markers[fmt(d)]?.emoji||'')+' '+(cell.dataset.note || markers[fmt(d)]?.note || '');
        tip.style.left=e.pageX+'px'; tip.style.top=e.pageY+'px';
      });
      cell.addEventListener('mouseleave', ()=> tip.hidden=true);

      cell.addEventListener('click', ()=>{
        const dateKey=fmt(d);
        const current=markers[dateKey]?.emoji || '';
        const emoji=prompt('Emoji m·ªëc cho ng√†y '+dateKey+' (vd: üéÇ). ƒê·ªÉ tr·ªëng ƒë·ªÉ xo√°.', current || 'üéÇ');
        if(emoji===null) return;
        if(emoji.trim()===''){ delete markers[dateKey]; }
        else{ const note=prompt('Ghi ch√∫ (tu·ª≥ ch·ªçn):', markers[dateKey]?.note || ''); markers[dateKey]={emoji, note}; }
        localStorage.setItem(key, JSON.stringify(markers)); render();
      });

      grid.appendChild(cell);
    });
  }
  document.getElementById('add-marker').onclick=()=>{
    const today=new Date(); const k=fmt(today);
    const emoji=prompt('Emoji cho h√¥m nay '+k+' (m·∫∑c ƒë·ªãnh üéÇ):','üéÇ'); if(emoji===null) return;
    const note=prompt('Ghi ch√∫ (tu·ª≥ ch·ªçn):','Sinh nh·∫≠t!')||'';
    markers[k]={emoji:emoji||'üéÇ',note}; localStorage.setItem(key, JSON.stringify(markers)); render();
  };
  document.getElementById('cal-prev').onclick=()=>{view.setMonth(view.getMonth()-1); render();};
  document.getElementById('cal-next').onclick=()=>{view.setMonth(view.getMonth()+1); render();};

  // seed 09/11
  (function(){
    const yyyy=new Date().getFullYear(); const d=new Date(yyyy,10,9); const k=fmt(d);
    if(!markers[k]){ markers[k]={emoji:'üéÇ',note:'Happy Birthday H√† Thanh'}; localStorage.setItem(key, JSON.stringify(markers)); }
  })();

  render();
})();

/* ========= Letter paw prints & open ========= */
(function(){
  function ensurePawLayer(container){
    let layer = container.querySelector('#paw-layer');
    if(!layer){ layer=document.createElement('div'); layer.id='paw-layer'; container.style.position = container.style.position || 'relative'; container.appendChild(layer); }
    return layer;
  }
  function spawnPaws(container,x,y,count=8){
    const layer=ensurePawLayer(container); const rect=layer.getBoundingClientRect();
    const baseX=(x ?? (rect.left+rect.width/2)) - rect.left;
    const baseY=(y ?? (rect.top+rect.height/2)) - rect.top;
    for(let i=0;i<count;i++){
      const el=document.createElement('div'); el.className='paw-pop'; el.textContent='üêæ';
      const dx=(Math.random()*24-12).toFixed(1)+'px'; const rot=(Math.random()*8-4).toFixed(1)+'deg';
      el.style.left=baseX+(Math.random()*30-15)+'px'; el.style.top=baseY+(Math.random()*12-6)+'px';
      el.style.setProperty('--dx',dx); el.style.setProperty('--rot',rot);
      layer.appendChild(el); el.addEventListener('animationend',()=>el.remove(),{once:true});
    }
  }
  const sweet = document.getElementById('sweet-letter');
  const birth = document.getElementById('birthday-letter');
  document.getElementById('sweetOpen').addEventListener('click', (e)=>{ sweet.classList.toggle('open'); spawnPaws(sweet,e.clientX,e.clientY,6); });
  document.getElementById('birthdayOpen').addEventListener('click', (e)=>{ birth.classList.toggle('open'); spawnPaws(birth,e.clientX,e.clientY,8); });
})();

/* ========= Music ========= */
(function(){
  const audio=document.getElementById('bgm'); const btn=document.getElementById('musicToggle');
  let playing=false; btn.onclick=()=>{ if(!playing){ audio.play(); playing=true; btn.textContent='‚è∏Ô∏è Pause'; } else { audio.pause(); playing=false; btn.textContent='‚ñ∂Ô∏è Play'; } };
})();

/* ========= Modals ========= */
(function(){
  const sad=document.getElementById('modalSad'), tired=document.getElementById('modalTired');
  document.getElementById('btnSadDay').onclick=()=>sad.classList.add('open');
  document.getElementById('btnTiredWork').onclick=()=>tired.classList.add('open');
  document.querySelectorAll('[data-close]').forEach(b=>b.onclick=()=>{document.querySelector(b.getAttribute('data-close')).classList.remove('open');});
  [sad,tired].forEach(m=>m.addEventListener('click',e=>{ if(e.target===m) m.classList.remove('open');}));
})();
</script>
</body>
</html>
